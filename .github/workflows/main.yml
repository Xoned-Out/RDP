name: Kali Tools SSH

on:
  workflow_dispatch:

jobs:
  kali-tools:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Install System Tools
        run: |
          sudo apt update
          sudo apt install -y \
            openssh-server \
            nmap \
            curl \
            wget \
            git \
            python3 \
            python3-pip \
            net-tools \
            iputils-ping \
            tshark \
            john \
            hydra \
            sqlmap \
            nikto \
            gobuster \
            dirb \
            netcat

      - name: Install Metasploit
        run: |
          # Download and install Metasploit
          wget https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb -O msfinstall
          chmod +x msfinstall
          sudo ./msfinstall

      - name: Install Python Tools
        run: |
          sudo pip3 install \
            requests \
            beautifulsoup4 \
            scapy \
            cryptography \
            pycryptodome \
            paramiko

      - name: Configure SSH
        run: |
          sudo systemctl enable ssh
          sudo systemctl start ssh
          sudo sed -i 's/#PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
          sudo systemctl restart ssh

      - name: Create User
        run: |
          PASSWORD=$(openssl rand -base64 12 | tr -dc 'a-zA-Z0-9' | head -c 10)
          USERNAME="hacker"
          sudo useradd -m -s /bin/bash $USERNAME
          echo "$USERNAME:$PASSWORD" | sudo chpasswd
          sudo usermod -aG sudo $USERNAME
          echo "SSH_USERNAME=$USERNAME" >> $GITHUB_ENV
          echo "SSH_PASSWORD=$PASSWORD" >> $GITHUB_ENV

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey="${{ secrets.TAILSCALE_AUTH_KEY }}" --hostname=kali-tools-$GITHUB_RUN_ID
          sleep 10
          TS_IP=$(tailscale ip -4)
          echo "TAILSCALE_IP=$TS_IP" >> $GITHUB_ENV

      - name: Download Additional Tools
        run: |
          # Download wordlists
          sudo mkdir -p /usr/share/wordlists
          sudo wget -O /usr/share/wordlists/rockyou.txt.gz https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt.gz
          sudo gunzip /usr/share/wordlists/rockyou.txt.gz || true
          
          # Download seclists
          sudo git clone https://github.com/danielmiessler/SecLists /usr/share/seclists || true

      - name: Display Connection Info
        run: |
          echo "=========================================="
          echo "üîê PENETRATION TESTING SSH"
          echo "=========================================="
          echo "IP: $TAILSCALE_IP"
          echo "Username: $SSH_USERNAME"
          echo "Password: $SSH_PASSWORD"
          echo "Port: 22"
          echo ""
          echo "üîß Connect: ssh $SSH_USERNAME@$TAILSCALE_IP"
          echo ""
          echo "üõ†Ô∏è  Available Tools:"
          echo "‚Ä¢ msfconsole (Metasploit)"
          echo "‚Ä¢ nmap"
          echo "‚Ä¢ sqlmap" 
          echo "‚Ä¢ john"
          echo "‚Ä¢ hydra"
          echo "‚Ä¢ nikto"
          echo "‚Ä¢ gobuster"
          echo "‚Ä¢ dirb"
          echo "‚Ä¢ tshark"
          echo "‚Ä¢ python3 with security libraries"
          echo "‚Ä¢ wordlists: rockyou.txt, SecLists"
          echo ""
          echo "üí° Example Commands:"
          echo "msfconsole"
          echo "nmap -sV target.com"
          echo "sqlmap -u 'http://test.com' --batch"
          echo "hydra -l user -P /usr/share/wordlists/rockyou.txt ssh://target"
          echo "=========================================="

      - name: Keep Alive
        run: |
          for i in {1..360}; do
            echo "SSH Active - $((360-i)) minutes left"
            sleep 60
          done
